/*
Created: 1/5/2023
Modified: 22/5/2023
Model: Oracle 18c
Database: Oracle 18c
*/


-- Create sequences section -------------------------------------------------

CREATE SEQUENCE una.MNP_JUGADOR_SEQ01
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 MINVALUE 0
 NOCACHE
;

CREATE SEQUENCE una.MNP_PROPIEDAD_SEQ01
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 MINVALUE 0
 NOCACHE
;

CREATE SEQUENCE una.MNP_TABLERO_SEQ01
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 MINVALUE 0
 NOCACHE
;

-- Create tables section -------------------------------------------------

-- Table una.MNP_JUGADOR

CREATE TABLE una.MNP_JUGADOR(
  jug_id Number NOT NULL,
  jug_nombre Varchar2(50 ) NOT NULL,
  jug_saldo Number NOT NULL,
  jug_ficha Varchar2(150 ) NOT NULL,
  jug_posicionX Number NOT NULL,
  jug_posicionY Number NOT NULL,
  pro_id Char(20 )
)
;

-- Create indexes for table una.MNP_JUGADOR

CREATE UNIQUE INDEX MNP_JUGADOR_UNQ01 ON una.MNP_JUGADOR (pro_id)
;

-- Add keys for table una.MNP_JUGADOR

ALTER TABLE una.MNP_JUGADOR ADD CONSTRAINT MNP_JUGADOR_PK PRIMARY KEY (jug_id)
;

-- Table and Columns comments section

COMMENT ON COLUMN una.MNP_JUGADOR.jug_id IS 'Id de cada Jugador'
;
COMMENT ON COLUMN una.MNP_JUGADOR.jug_nombre IS 'Nombre del jugador'
;
COMMENT ON COLUMN una.MNP_JUGADOR.jug_saldo IS 'Dinero del jugador'
;
COMMENT ON COLUMN una.MNP_JUGADOR.jug_ficha IS 'ficha del jugador'
;
COMMENT ON COLUMN una.MNP_JUGADOR.jug_posicionX IS 'Posicion X del jugador'
;
COMMENT ON COLUMN una.MNP_JUGADOR.jug_posicionY IS 'Posicion Y del jugador'
;

-- Table una.MNP_TABLERO

CREATE TABLE una.MNP_TABLERO(
  tab_id Number NOT NULL,
  tab_jugador1Debe Varchar2(1 ) DEFAULT 'N' NOT NULL,
  tab_jugador2Debe Varchar2(1 ) DEFAULT 'N' NOT NULL,
  jug_id Number,
  CONSTRAINT MNP_TABLERO_CK01 CHECK (tab_jugador1Debe in ('S','N')),
  CONSTRAINT MNP_TABLERO_CK02 CHECK (tab_jugador2Debe in ('S','N'))
)
;

-- Create indexes for table una.MNP_TABLERO

CREATE INDEX una.MNP_TABLERO_UNQ01 ON una.MNP_TABLERO (jug_id)
;

-- Add keys for table una.MNP_TABLERO

ALTER TABLE una.MNP_TABLERO ADD CONSTRAINT MNP_TABLERO_PK PRIMARY KEY (tab_id)
;

-- Table and Columns comments section

COMMENT ON COLUMN una.MNP_TABLERO.tab_id IS 'Id de cada tablero o juego creado'
;
COMMENT ON COLUMN una.MNP_TABLERO.tab_jugador1Debe IS 'Jugador 1 tiene alguna deuda o no(S: si N: no)'
;
COMMENT ON COLUMN una.MNP_TABLERO.tab_jugador2Debe IS 'Jugador 2 tiene alguna deuda o no(S: si N: no)'
;

-- Table una.MNP_PROPIEDAD

CREATE TABLE una.MNP_PROPIEDAD(
  pro_id Char(20 ) NOT NULL,
  pro_nombre Varchar2(60 ) NOT NULL,
  pro_hipotecada Varchar2(1 ) DEFAULT 'N' NOT NULL,
  pro_casas Number,
  pro_hotel Number,
  CONSTRAINT MNP_PROPIEDAD_CK01 CHECK (pro_hipotecada in ('S','N'))
)
;

-- Add keys for table una.MNP_PROPIEDAD

ALTER TABLE una.MNP_PROPIEDAD ADD CONSTRAINT PK_MNP_PROPIEDAD PRIMARY KEY (pro_id)
;

-- Table and Columns comments section

COMMENT ON COLUMN una.MNP_PROPIEDAD.pro_id IS 'Id de la propiedad'
;
COMMENT ON COLUMN una.MNP_PROPIEDAD.pro_nombre IS 'Nombre de la propiedad'
;
COMMENT ON COLUMN una.MNP_PROPIEDAD.pro_hipotecada IS 'Si la propiedad de encuentra hipotecada(S: si N: no)'
;
COMMENT ON COLUMN una.MNP_PROPIEDAD.pro_casas IS 'Casas que posee la propiedad'
;
COMMENT ON COLUMN una.MNP_PROPIEDAD.pro_hotel IS 'Si  la propiedad posee hotel'
;

-- Trigger for sequence una.MNP_JUGADOR_SEQ01 for column jug_id in table una.MNP_JUGADOR ---------
CREATE OR REPLACE TRIGGER una.MNP_JUGADOR_TGR01 BEFORE INSERT
ON una.MNP_JUGADOR FOR EACH ROW
BEGIN
    IF :new.jug_id IS NULL OR :new.jug_id <= 0 THEN
        :new.jug_id := una.MNP_JUGADOR_SEQ01.nextval;
    END IF;
END;
/
CREATE OR REPLACE TRIGGER una.MNP_JUGADOR_TGR02 AFTER UPDATE OF jug_id
ON una.MNP_JUGADOR FOR EACH ROW
BEGIN
  RAISE_APPLICATION_ERROR(-20010,'Cannot update column jug_id in table una.MNP_JUGADOR as it uses sequence.');
END;
/

-- Trigger for sequence una.MNP_TABLERO_SEQ01 for column tab_id in table una.MNP_TABLERO ---------
CREATE OR REPLACE TRIGGER una.MNP_TABLERO_TGR01 BEFORE INSERT
ON una.MNP_TABLERO FOR EACH ROW
BEGIN
    IF :new.tab_id IS NULL OR :new.tab_id <= 0 THEN
        :new.tab_id := una.MNP_TABLERO_SEQ01.nextval;
    END IF;
END;
/
CREATE OR REPLACE TRIGGER una.MNP_TABLERO_TGR02 AFTER UPDATE OF tab_id
ON una.MNP_TABLERO FOR EACH ROW
BEGIN
  RAISE_APPLICATION_ERROR(-20010,'Cannot update column tab_id in table una.MNP_TABLERO as it uses sequence.');
END;
/

-- Trigger for sequence una.MNP_PROPIEDAD_SEQ01 for column pro_id in table una.MNP_PROPIEDAD ---------
CREATE OR REPLACE TRIGGER una.MNP_PROPIEDAD_TGR01 BEFORE INSERT
ON una.MNP_PROPIEDAD FOR EACH ROW
BEGIN
    IF :new.pro_id IS NULL OR :new.pro_id <= 0 THEN
        :new.pro_id := una.MNP_PROPIEDAD_SEQ01.nextval;
    END IF;
END;
/
CREATE OR REPLACE TRIGGER una.MNP_PROPIEDAD_TGR02 AFTER UPDATE OF pro_id
ON una.MNP_PROPIEDAD FOR EACH ROW
BEGIN
  RAISE_APPLICATION_ERROR(-20010,'Cannot update column pro_id in table una.MNP_PROPIEDAD as it uses sequence.');
END;
/


-- Create foreign keys (relationships) section ------------------------------------------------- 

ALTER TABLE una.MNP_TABLERO ADD CONSTRAINT MNP_TABJUG_FK01 FOREIGN KEY (jug_id) REFERENCES una.MNP_JUGADOR (jug_id)
;


ALTER TABLE una.MNP_JUGADOR ADD CONSTRAINT MNP_JUGPROP_FK01 FOREIGN KEY (pro_id) REFERENCES una.MNP_PROPIEDAD (pro_id)
;




-- Grant permissions section -------------------------------------------------


